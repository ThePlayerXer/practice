{% extends 'base.html' %}
{% load static %}

{% block title %}Корзина - PC Store{% endblock %}

{% block content %}
<div class="cart-container">
    <div class="container">
        <h1 class="page-title">Корзина покупок</h1>
        
        {% if cart_items %}
        <div class="cart-layout">
            <!-- Список товаров -->
            <div class="cart-items">
                <div class="cart-header">
                    <div class="cart-header-item">Товар</div>
                    <div class="cart-header-item">Цена</div>
                    <div class="cart-header-item">Количество</div>
                    <div class="cart-header-item">Сумма</div>
                    <div class="cart-header-item">Действия</div>
                </div>
                
                {% for item in cart_items %}
                <div class="cart-item">
                    <div class="cart-item-product">
                        <div class="cart-item-image">
                            {% if item.product.image %}
                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                            {% else %}
                            <div class="no-image-small">
                                <i class="fas fa-image"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div class="cart-item-info">
                            <h3 class="cart-item-title">{{ item.product.name }}</h3>
                            <p class="cart-item-category">{{ item.product.category.name }}</p>
                        </div>
                    </div>
                    
                    <div class="cart-item-price">
                        {{ item.product.get_final_price }} ₽
                    </div>
                    
                    <div class="cart-item-quantity">
                        <form action="{% url 'cart:cart_update' item.product.id %}" method="post" class="quantity-form">
                            {% csrf_token %}
                            <div class="quantity-controls">
                                <button type="button" class="quantity-btn minus">-</button>
                                <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="{{ item.product.stock }}" class="quantity-input">
                                <button type="button" class="quantity-btn plus">+</button>
                            </div>
                            <button type="submit" class="btn btn-small">Обновить</button>
                        </form>
                    </div>
                    
                    <div class="cart-item-total">
                        {{ item.get_total_price }} ₽
                    </div>
                    
                    <div class="cart-item-actions">
                        <a href="{% url 'cart:cart_remove' item.product.id %}" class="btn btn-danger btn-small">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Итоги и оформление -->
            <div class="cart-summary">
                <div class="summary-card">
                    <h3 class="summary-title">Итого</h3>
                    
                    <div class="summary-row">
                        <span>Товары ({{ total_items }})</span>
                        <span>{{ total_price }} ₽</span>
                    </div>
                    
                    <div class="summary-row">
                        <span>Доставка</span>
                        <span>0 ₽</span>
                    </div>
                    
                    <div class="summary-divider"></div>
                    
                    <div class="summary-row total">
                        <span>Общая сумма</span>
                        <span>{{ total_price }} ₽</span>
                    </div>
                    
                    <div class="summary-actions">
                        <a href="{% url 'cart:checkout' %}" class="btn btn-primary btn-large">Оформить заказ</a>
                        <a href="{% url 'products:catalog' %}" class="btn btn-outline">Продолжить покупки</a>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="empty-cart">
            <div class="empty-cart-icon">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <h2>Ваша корзина пуста</h2>
            <p>Добавьте товары из каталога, чтобы продолжить покупки</p>
            <a href="{% url 'products:catalog' %}" class="btn btn-primary">Перейти в каталог</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const quantityForms = document.querySelectorAll('.quantity-form');
    
    quantityForms.forEach(form => {
        const minusBtn = form.querySelector('.minus');
        const plusBtn = form.querySelector('.plus');
        const input = form.querySelector('.quantity-input');
        
        minusBtn.addEventListener('click', function() {
            let value = parseInt(input.value);
            if (value > 1) {
                input.value = value - 1;
            }
        });
        
        plusBtn.addEventListener('click', function() {
            let value = parseInt(input.value);
            input.value = value + 1;
        });
    });
});
</script>
{% endblock %}